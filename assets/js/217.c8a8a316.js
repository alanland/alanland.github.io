(window.webpackJsonp=window.webpackJsonp||[]).push([[217],{931:function(e,s,n){"use strict";n.r(s);var a=n(6),t=Object(a.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p",[e._v("在ansible的使用过程中，存在这样的场景，ansible所在的管理节点与被管理的机器需要 通过一个跳板机才能连接，无法直接连接。网上搜了一下，要解决这个问题，并不需要在 ansible里做什么处理，而是在ssh连接层面解决这个问题。")]),e._v(" "),n("p",[e._v("比如，")]),e._v(" "),n("p",[e._v("我们有三类节点：")]),e._v(" "),n("ol",[n("li",[e._v("管理节点，"),n("code",[e._v("admin.example.com")]),e._v("，是执行ansible命令的服务器")]),e._v(" "),n("li",[e._v("被管理的节点，"),n("code",[e._v("internal1.example.com")]),e._v(", "),n("code",[e._v("internal2.example.com")])]),e._v(" "),n("li",[e._v("跳板机，"),n("code",[e._v("bastion.example.com")])])]),e._v(" "),n("p",[e._v("管理节点不能直连 internal1 & internal2，需要通过跳板机建立连接。")]),e._v(" "),n("p",[e._v("管理节点连接跳板机的方式如下：")]),e._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" -i keyfile_bastion -p "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("12345")]),e._v(" user@bastion.example.com\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("从跳板机连接internal节点的方式如下：")]),e._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" -i keyfile_internal -p "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("23456")]),e._v(" user@internal1.example.com\n"),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" -i keyfile_internal -p "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("23456")]),e._v(" user@internal2.example.com\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("解决方案：")]),e._v(" "),n("p",[e._v("修改 "),n("code",[e._v("~/.ssh/config")]),e._v("，加入如下的配置项，")]),e._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[e._v("Host internal1.example.com internal2.example.com\n    User user\n    Port "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("23456")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("IdentityFile")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("keyfile_internal\n    ProxyCommand "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" -qaY -i keyfile_bastion -p "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("12345")]),e._v(" user@bastion.example.com "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'nc -w 14400 %h %p'")]),e._v("\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("这样，就可以直接从节点 admin.example.com 执行下面的命令直接连接internal1.example.com了")]),e._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" user@internal1.example.com\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("ansible中也可以将internal节点当做可以直接连接的机器来使用")]),e._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[e._v("ansible -i "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("host")]),e._v(" -m setup internal1.example.com\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("ul",[n("li",[n("a",{attrs:{href:"https://ouyang.me/blog/2015/08/31/using-ansible-with-a-bastion-host",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ansible结合跳板机控制远程服务器"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"http://www.cweye.net/2015/07/17/ansible-jumper.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ansible通过跳板机管理服务器"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=t.exports}}]);