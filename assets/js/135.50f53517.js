(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{830:function(t,s,e){"use strict";e.r(s);var a=e(6),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"data-type"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#data-type"}},[t._v("#")]),t._v(" data type")]),t._v(" "),e("p",[t._v("比如数据:")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("wms_shipment_count_daily_g"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("company"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"company3"')]),t._v(",customer"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"media"')]),t._v(",exported_job"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my_job"')]),t._v(",instance"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pushgateway:9091"')]),t._v(",job"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pushgateway"')]),t._v(",warehouse"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("ul",[e("li",[t._v("即时向量(Instant vector) 包含每个时间序列的单个样本的一组时间序列，共享相同的时间戳。")]),t._v(" "),e("li",[t._v("wms_shipment_count_daily_g")]),t._v(" "),e("li",[t._v("rate(wms_shipment_count_daily_g[10m])")]),t._v(" "),e("li",[t._v("范围向量(Range vector) 包含每个时间序列随时间变化的数据点的一组时间序列。")]),t._v(" "),e("li",[t._v("wms_shipment_count_daily_g[10m]")]),t._v(" "),e("li",[t._v("标量(Scalar) 一个简单的数字浮点值")]),t._v(" "),e("li",[t._v("字符串(String) 一个简单的字符串值(目前未被使用)")])]),t._v(" "),e("h2",{attrs:{id:"time-series-selectors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#time-series-selectors"}},[t._v("#")]),t._v(" Time series Selectors")]),t._v(" "),e("p",[e("code",[t._v("selects all time series")]),t._v(" that have the http_requests_total metric name")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("http_requests_total\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[e("code",[t._v("filter these time series")]),t._v(" further by appending a set of labels to match in curly braces ({}).")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("http_requests_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("job"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("group"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canary"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[e("code",[t._v("label matching operators")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("=")]),t._v(" : Select labels that are exactly equal to the provided string.")]),t._v(" "),e("li",[e("code",[t._v("!=")]),t._v(" : Select labels that are not equal to the provided string.")]),t._v(" "),e("li",[e("code",[t._v("=~")]),t._v(" : Select labels that regex-match the provided string (or substring).")]),t._v(" "),e("li",[e("code",[t._v("!~")]),t._v(" : Select labels that do not regex-match the provided string (or substring).")])]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("http_requests_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("environment"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"staging|testing|development"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("method"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("Vector selectors must either specify a name or at least one label matcher that does not match the empty string.")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("job"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('".*"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Bad!")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("job"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('".+"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("              "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Good!")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("job"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('".*"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("method"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Good!")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[e("code",[t._v("http_requests_total")]),t._v(" is equivalent to "),e("code",[t._v('{__name__="http_requests_total"}')]),t._v(",\nMatchers other than "),e("code",[t._v("= (!=, =~, !~)")]),t._v(" may also be used")]),t._v(" "),e("h2",{attrs:{id:"range-vector-selectors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#range-vector-selectors"}},[t._v("#")]),t._v(" Range Vector Selectors")]),t._v(" "),e("p",[t._v("range duration is appended in square brackets ("),e("code",[t._v("[]")]),t._v(") at the "),e("code",[t._v("end of a vector selector")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("s")]),t._v(" - seconds")]),t._v(" "),e("li",[e("code",[t._v("m")]),t._v(" - minutes")]),t._v(" "),e("li",[e("code",[t._v("h")]),t._v(" - hours")]),t._v(" "),e("li",[e("code",[t._v("d")]),t._v(" - days")]),t._v(" "),e("li",[e("code",[t._v("w")]),t._v(" - weeks")]),t._v(" "),e("li",[e("code",[t._v("y")]),t._v(" - years")])]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("http_requests_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("job"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("5m"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h2",{attrs:{id:"offset-modifier"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#offset-modifier"}},[t._v("#")]),t._v(" Offset modifier")]),t._v(" "),e("p",[t._v("The offset modifier allows changing the time offset for individual instant and range vectors in a query")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 五分钟前的数据")]),t._v("\nhttp_requests_total offset 5m \n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("offest 始终需要跟随选择器")]),t._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http_requests_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("method"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" offset "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("m"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GOOD.")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http_requests_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("method"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" offset "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("m "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// INVALID.")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[t._v("##　操作符")]),t._v(" "),e("h3",{attrs:{id:"comparison-binary-operators"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#comparison-binary-operators"}},[t._v("#")]),t._v(" Comparison binary operators")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("==")]),t._v(" (equal)")]),t._v(" "),e("li",[e("code",[t._v("!=")]),t._v(" (not-equal)")]),t._v(" "),e("li",[e("code",[t._v(">")]),t._v(" (greater-than)")]),t._v(" "),e("li",[e("code",[t._v("<")]),t._v(" (less-than)")]),t._v(" "),e("li",[e("code",[t._v(">=")]),t._v(" (greater-or-equal)")]),t._v(" "),e("li",[e("code",[t._v("<=")]),t._v(" (less-or-equal)")])]),t._v(" "),e("h3",{attrs:{id:"logical-set-binary-operators"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logical-set-binary-operators"}},[t._v("#")]),t._v(" Logical/set binary operators")]),t._v(" "),e("p",[t._v("These logical/set binary operators are only defined between instant vectors:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("and")]),t._v(" (intersection)")]),t._v(" "),e("li",[e("code",[t._v("or")]),t._v(" (union)")]),t._v(" "),e("li",[e("code",[t._v("unless")]),t._v(" (complement)")])]),t._v(" "),e("h3",{attrs:{id:"aggregation-operators"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aggregation-operators"}},[t._v("#")]),t._v(" Aggregation operators")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("sum")]),t._v(" (calculate sum over dimensions)")]),t._v(" "),e("li",[e("code",[t._v("min")]),t._v(" (select minimum over dimensions)")]),t._v(" "),e("li",[e("code",[t._v("max")]),t._v(" (select maximum over dimensions)")]),t._v(" "),e("li",[e("code",[t._v("avg")]),t._v(" (calculate the average over dimensions)")]),t._v(" "),e("li",[e("code",[t._v("stddev")]),t._v(" (calculate population standard deviation over dimensions)s)")]),t._v(" "),e("li",[e("code",[t._v("stdvar")]),t._v(" (calculate population standard variance over dimensions))")]),t._v(" "),e("li",[e("code",[t._v("count")]),t._v(" (count number of elements in the vector)")]),t._v(" "),e("li",[e("code",[t._v("count_values")]),t._v(" (count number of elements with the same value)")]),t._v(" "),e("li",[e("code",[t._v("bottomk")]),t._v(" (smallest k elements by sample value)")]),t._v(" "),e("li",[e("code",[t._v("topk")]),t._v(" (largest k elements by sample value)")]),t._v(" "),e("li",[e("code",[t._v("quantile")]),t._v(" (calculate φ-quantile (0 ≤ φ ≤ 1) over dimensions)")])]),t._v(" "),e("p",[t._v("可以使用function: "),e("code",[t._v("<aggregation>_over_time")])]),t._v(" "),e("h2",{attrs:{id:"示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wms_shipment_count_daily_g"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" by"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("warehouse"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsum"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wms_shipment_count_daily_g"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" by"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("warehouse"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsum"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wms_shipment_count_daily_g"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" without"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("warehouse, campany"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sum_over_time")]),t._v("\nsum"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sum_over_time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wms_shipment_count_daily_g"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("10s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" by "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("warehouse"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("hr"),t._v(" "),e("p",[t._v("Links:")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://prometheus.io/docs/querying/basics/",target:"_blank",rel:"noopener noreferrer"}},[t._v("basics"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://prometheus.io/docs/querying/operators/",target:"_blank",rel:"noopener noreferrer"}},[t._v("operators"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://prometheus.io/docs/querying/functions/",target:"_blank",rel:"noopener noreferrer"}},[t._v("functions"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"http://www.jianshu.com/p/d187ac561eb8",target:"_blank",rel:"noopener noreferrer"}},[t._v("jianshu"),e("OutboundLink")],1)])]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("END")])])}),[],!1,null,null,null);s.default=n.exports}}]);