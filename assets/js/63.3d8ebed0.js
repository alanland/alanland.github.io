(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{1045:function(e,s,r){"use strict";r.r(s);var a=r(6),t=Object(a.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("Aliyun 的 Kubernetes 测试环境 CI 更新的时候，卡住了。")]),e._v(" "),a("p",[e._v("开始以为是服务器资源不足，后来查看控制台 Pod 的状态：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('error killing pod: [failed to "KillContainer" for "istio-proxy" with KillContainerError: "rpc error: code = Unknown desc = operation timeout: context deadline exceeded" , failed to "KillContainer" for "wms" with KillContainerError: "rpc error: code = Unknown desc = operation timeout: context deadline exceeded" , failed to "KillPodSandbox" for "35ced948-e3af-11e9-aa25-eed95802c543" with KillPodSandboxError: "rpc error: code = DeadlineExceeded desc = context deadline exceeded" ]\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("命令行查看")]),e._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("~ kgp\nNAME                                READY   STATUS        RESTARTS   AGE\nwms-6d7bcb44f6-q2qbx                "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/2     Terminating   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          7d10h\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("执行")]),e._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("kdelp xxx\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("删除 Pod，Deployment 和 Service 均无法删除。")]),e._v(" "),a("p",[e._v("使用命令")]),e._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("kdelp xxx --now\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("也不行。")]),e._v(" "),a("p",[e._v("最后执行")]),e._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("kdelp xxx --grace-period"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" --force\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("停止的 Pod 被删除掉了。")]),e._v(" "),a("p",[e._v("重新 apply 配置，Pod 的最后5次事件是：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Error creating load balancer (will retry): failed to ensure load balancer for service loghub/wms: update backend servers: error ensure vgroup: Aliyun API Error: RequestId: 62C1B690-59F7-46B4-8B45-46080E30A129 Status Code: 400 Code: BackendServerRelatedInstanceNumerOverLimit Message: There is backend server has reached to the quota limit number of load balancers that it could be related to.. k8s/32510/wms/loghub/clusterid\nservice-controller\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("大致意思是 load balancer 监听的后端已经到了上限，不能再添加了。（")]),e._v(" "),a("p",[e._v("随便搜了下，没有找个类似错误，在阿里云负载均衡的 "),a("a",{attrs:{href:"https://error-center.alibabacloud.com/status/product/Slb",target:"_blank",rel:"noopener noreferrer"}},[e._v("API 错误"),a("OutboundLink")],1),e._v(" 里面也没有搜索到这个错误。")]),e._v(" "),a("p",[e._v("进入阿里云负载均衡控制台](https://slb.console.aliyun.com/slb/cn-hangzhou/slbs) 找到最可以的那一个")]),e._v(" "),a("p",[a("img",{attrs:{src:r(504),alt:""}})]),e._v(" "),a("p",[e._v("删除了一个不可用的监听，再次 Apply Kubernetes 对象，成功了。")]),e._v(" "),a("p",[e._v("看了一下帮助，也没有找到")]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("参考：")]),e._v(" "),a("ul",[a("li",[e._v("https://stackoverflow.com/questions/50336665/how-do-i-force-delete-kubernetes-pods/50338057")])])])}),[],!1,null,null,null);s.default=t.exports},504:function(e,s,r){e.exports=r.p+"assets/img/aliyun-lbs-listeners.c235c170.png"}}]);