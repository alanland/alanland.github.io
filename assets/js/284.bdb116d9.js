(window.webpackJsonp=window.webpackJsonp||[]).push([[284],{999:function(a,s,t){"use strict";t.r(s);var e=t(6),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"安装配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装配置"}},[a._v("#")]),a._v(" 安装配置")]),a._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#log file name")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("logFileName")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" tprofiler.log")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("methodFileName")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" tmethod.log")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("samplerFileName")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" tsampler.log")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#basic configuration items")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("startProfTime")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" 9:00:00 # 开始时间")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("endProfTime")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" 23:00:00 # 结束时间")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("eachProfUseTime")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" 5")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("eachProfIntervalTime")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" 50")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("samplerIntervalTime")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" 20")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("port")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" 30000 # 启动端口")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("debugMode")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" false")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("needNanoTime")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" false")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ignoreGetSetMethod")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" true")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#file paths")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("logFilePath")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" ${user.home}/logs/${logFileName}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("methodFilePath")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" ${user.home}/logs/${methodFileName}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("samplerFilePath")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" ${user.home}/logs/${samplerFileName}")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#include & excludes items")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("excludeClassLoader")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 要监控的包")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("includePackageStartsWith")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" com.caucho;com.defonds;com.fasterxml;com.sun.jersey;com.sun.jmx;org.apache;org.codehaus;org.jdbcdslog;org.mybatis;org.quartz;org.springframework")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("excludePackageStartsWith")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" com.taobao.sketch;org.apache.velocity;com.alibaba;com.taobao.forest.domain.dataobject")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br")])]),t("h2",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[a._v("#")]),a._v(" 使用")]),a._v(" "),t("p",[a._v("JVM应用启动参数：")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("-javaagent:/home/ic/tprofiler/tprofiler.jar -Dprofile.properties"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/ic/tprofiler/profile.properties\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("Tomcat的话，修改"),t("code",[a._v("catalina.sh")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JAVA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('" -javaagent:/home/ic/tprofiler/tprofiler.jar -Dprofile.properties=/home/ic/tprofiler/profile.properties"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("分析tsampler.log采样文件，输出method.log与thread.log两文件")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("java -cp tprofiler.jar com.taobao.profile.analysis.SamplerLogAnalysis  /home/ic/logs/tsampler.log /home/ic/logs/method.log /home/ic/logs/thread.log\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("分析tprofiler.log采样文件，输出topmethod.log与topobject.log两文件，需要tmethod.log文件为输入")]),a._v(" "),t("ol",[t("li",[a._v("首先生成tmethod.log文件(必需等到profile.properties文件中endProfTime属性定义的时间点结束后，才能生成，因此需人工提前生成)，由此命令")])]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("java -cp tprofiler.jar com.taobao.profile.client.TProfilerClient "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50000")]),a._v(" flushmethod    \n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("生成topmethod.log与topobject.log两文件，")])]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("java -cp tprofiler.jar com.taobao.profile.analysis.ProfilerLogAnalysis /home/ic/logs/tprofiler.log /home/ic/logs/tmethod.log /home/ic/logs/topmethod.log /home/ic/logs/topobject.log\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h2",{attrs:{id:"启动停止"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动停止"}},[a._v("#")]),a._v(" 启动停止")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("java -cp tprofiler.jar com.taobao.profile.client.TProfilerClient "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50000")]),a._v(" stauts\njava -cp tprofiler.jar com.taobao.profile.client.TProfilerClient "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50000")]),a._v(" stop\njava -cp tprofiler.jar com.taobao.profile.client.TProfilerClient "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50000")]),a._v(" start\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("h2",{attrs:{id:"文件格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件格式"}},[a._v("#")]),a._v(" 文件格式")]),a._v(" "),t("p",[a._v("###topobject.log")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("方法信息 执行次数 平均执行时间 全部执行时间\nsketch/compile/parser/node/PropertyExecutor:<init>:32 573 1 636\nsketch/util/introspection/UberspectImpl:<init>:282 34 7 241\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[t("strong",[a._v("实验时，文件没有写入内容。分析代码是方法名必需包括"),t("init",[a._v("，才会写入。")])],1)]),a._v(" "),t("h3",{attrs:{id:"tprofiler-log"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tprofiler-log"}},[a._v("#")]),a._v(" tprofiler.log")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("线程ID 线程栈深度 方法ID 方法执行时间\n13        2       14558       6\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h3",{attrs:{id:"topmethod-log"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#topmethod-log"}},[a._v("#")]),a._v(" topmethod.log")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("方法信息     执行次数    平均执行时间       全部执行时间 \ncom/tcs/server/mpush/connect/MessageReceivedHandler:received:13613022 2472\ncom/tcs/server/mpush/connect/Login:validateToken:56682 138\ncom/tcs/server/mpush/connect/Login:sendOfflineMessage:112102 20\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("h3",{attrs:{id:"method-log文件格式说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#method-log文件格式说明"}},[a._v("#")]),a._v(" method.log文件格式说明:")]),a._v(" "),t("p",[a._v("方法信息 采样过程中方法出现次数")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("org.quartz.simpl.SimpleThreadPool.getNextRunnable(SimpleThreadPool.java:428) 19728\norg.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:518) 19728\norg.quartz.simpl.SimpleThreadPool.access$000(SimpleThreadPool.java:47) 19728\norg.apache.mina.util.NamePreservingRunnable.run(NamePreservingRunnable.java:51) 17558\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("h3",{attrs:{id:"thread-log文件格式说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#thread-log文件格式说明"}},[a._v("#")]),a._v(" thread.log文件格式说明:")]),a._v(" "),t("p",[a._v("线程信息 采样过程中线程出现次数")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("56 DefaultQuartzScheduler_Worker-3 TIMED_WAITING 661\n55 DefaultQuartzScheduler_Worker-2 TIMED_WAITING 661\n60 DefaultQuartzScheduler_Worker-7 TIMED_WAITING 661\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("hr"),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/alibaba/TProfiler",target:"_blank",rel:"noopener noreferrer"}},[a._v("TProfiler GitHub"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/alibaba/TProfiler/issues/33",target:"_blank",rel:"noopener noreferrer"}},[a._v("TProfiler.log的内容为空"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/defonds/article/details/52605670",target:"_blank",rel:"noopener noreferrer"}},[a._v("JVM 性能调优实战之：使用阿里开源工具 TProfiler 在海量业务代码中精确定位性能代码"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/wh0426/article/details/51994054",target:"_blank",rel:"noopener noreferrer"}},[t("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);