(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{852:function(_,v,e){"use strict";e.r(v);var t=e(6),a=Object(t.a)({},(function(){var _=this,v=_.$createElement,e=_._self._c||v;return e("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[e("p",[_._v("MySql二进制日志(binlog)有"),e("code",[_._v("3")]),_._v("种不同的格式可选："),e("code",[_._v("Mixed")]),_._v(","),e("code",[_._v("Statement")]),_._v(","),e("code",[_._v("Row")]),_._v("，\n默认格式是"),e("code",[_._v("Statement")]),_._v(".")]),_._v(" "),e("h2",{attrs:{id:"row"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#row"}},[_._v("#")]),_._v(" Row")]),_._v(" "),e("p",[_._v("日志中会记录成每一行数据被修改的形式.")]),_._v(" "),e("p",[_._v("不记录执行的SQL语句的上下文相关的信息，\n仅仅只需要记录哪一条记录被修改了，修改成什么样了.")]),_._v(" "),e("p",[_._v("比如:")]),_._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("update")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("table")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("user")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("set")]),_._v(" password"),e("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[_._v("'xxx'")]),_._v("\n")])]),_._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[_._v("1")]),e("br")])]),e("p",[_._v("那么影响的每一条记录都会被日志记下来.")]),_._v(" "),e("h2",{attrs:{id:"statement"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#statement"}},[_._v("#")]),_._v(" Statement")]),_._v(" "),e("p",[_._v("每一条会修改数据的SQL都会记录到bin-log中.")]),_._v(" "),e("p",[e("code",[_._v("Statement")]),_._v("模式没有"),e("code",[_._v("Row")]),_._v("模式日志文件大的问题,但是部分函数不能正确复制,比如"),e("code",[_._v("sleep")]),_._v(".")]),_._v(" "),e("h2",{attrs:{id:"mixed"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mixed"}},[_._v("#")]),_._v(" Mixed")]),_._v(" "),e("p",[e("code",[_._v("5.1.8")]),_._v("版本之后提供了"),e("code",[_._v("Mixed")]),_._v("模式,即两种模式的结合.")]),_._v(" "),e("p",[_._v("比如"),e("code",[_._v("alter")]),_._v("操作使用"),e("code",[_._v("statement")]),_._v("模式,"),e("code",[_._v("update")]),_._v(","),e("code",[_._v("delete")]),_._v("使用"),e("code",[_._v("statemest")]),_._v("模式.")]),_._v(" "),e("p",[_._v("如果binlog采用了"),e("code",[_._v("Mixed")]),_._v("模式,那么在以下几种情况下会自动将binlog的模式由"),e("code",[_._v("Statement")]),_._v("模式变为"),e("code",[_._v("Row")]),_._v("模式：")]),_._v(" "),e("ol",[e("li",[_._v("当"),e("code",[_._v("DML")]),_._v("语句更新一个"),e("code",[_._v("NDB")]),_._v("表时 ("),e("code",[_._v("NDB")]),_._v(" MySql Cluster 的存储引擎)")]),_._v(" "),e("li",[_._v("当函数中包含"),e("code",[_._v("UUID()")]),_._v("时")]),_._v(" "),e("li",[_._v("2个及以上包含"),e("code",[_._v("AUTO_INCREMENT")]),_._v("字段的表被更新时")]),_._v(" "),e("li",[_._v("执行"),e("code",[_._v("INSERT DELAYED")]),_._v("语句时")]),_._v(" "),e("li",[_._v("用"),e("code",[_._v("UDF")]),_._v("时")]),_._v(" "),e("li",[_._v("视图中必须要求运用"),e("code",[_._v("Row")]),_._v("时,例如建立视图时使用了"),e("code",[_._v("UUID()")]),_._v("函数")])]),_._v(" "),e("hr"),_._v(" "),e("p",[_._v("ps:")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("DDL")]),_._v(" 数据库模式定义语言 "),e("code",[_._v("create")])]),_._v(" "),e("li",[e("code",[_._v("DML")]),_._v(" 数据操纵语言 "),e("code",[_._v("Insert/delete/update")])]),_._v(" "),e("li",[e("code",[_._v("DCL")]),_._v(" 数据库控制语言 "),e("code",[_._v("grant/remove")])]),_._v(" "),e("li",[e("code",[_._v("DQL")]),_._v(" 数据库查询语言 "),e("code",[_._v("select")])])]),_._v(" "),e("hr"),_._v(" "),e("h2",{attrs:{id:"两种模式的对比"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#两种模式的对比"}},[_._v("#")]),_._v(" 两种模式的对比")]),_._v(" "),e("h3",{attrs:{id:"statement-优点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#statement-优点"}},[_._v("#")]),_._v(" Statement 优点")]),_._v(" "),e("ul",[e("li",[_._v("历史悠久，技术成熟；")]),_._v(" "),e("li",[_._v("产生的 binlog 文件较小；")]),_._v(" "),e("li",[_._v("binlog 中包含了所有数据库修改信息，可以据此来审核数据库的安全等情况；")]),_._v(" "),e("li",[_._v("binlog 可以用于实时的还原，而不仅仅用于复制；")]),_._v(" "),e("li",[_._v("主从版本可以不一样，从服务器版本可以比主服务器版本高；")])]),_._v(" "),e("h3",{attrs:{id:"statement-缺点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#statement-缺点"}},[_._v("#")]),_._v(" Statement 缺点：")]),_._v(" "),e("ul",[e("li",[_._v("不是所有的 UPDATE 语句都能被复制，尤其是包含不确定操作的时候；")]),_._v(" "),e("li",[_._v("调用具有不确定因素的 UDF 时复制也可能出现问题；")]),_._v(" "),e("li",[_._v("运用以下函数的语句也不能被复制：")]),_._v(" "),e("li",[_._v("LOAD_FILE()")]),_._v(" "),e("li",[_._v("UUID()")]),_._v(" "),e("li",[_._v("USER()")]),_._v(" "),e("li",[_._v("FOUND_ROWS()")]),_._v(" "),e("li",[_._v("SYSDATE() (除非启动时启用了 –sysdate-is-now 选项)")]),_._v(" "),e("li",[_._v("INSERT … SELECT 会产生比 RBR 更多的行级锁；")]),_._v(" "),e("li",[_._v("复制须要执行全表扫描 (WHERE 语句中没有运用到索引) 的 UPDATE 时，须要比 row 请求更多的行级锁；")]),_._v(" "),e("li",[_._v("对于有 AUTO_INCREMENT 字段的 InnoDB 表而言，INSERT 语句会阻塞其他 INSERT 语句；")]),_._v(" "),e("li",[_._v("对于一些复杂的语句，在从服务器上的耗资源情况会更严重，而 row 模式下，只会对那个发生变化的记录产生影响；")]),_._v(" "),e("li",[_._v("存储函数(不是存储流程 )在被调用的同时也会执行一次 NOW() 函数，这个可以说是坏事也可能是好事；")]),_._v(" "),e("li",[_._v("确定了的 UDF 也须要在从服务器上执行；")]),_._v(" "),e("li",[_._v("数据表必须几乎和主服务器保持一致才行，否则可能会导致复制出错；")]),_._v(" "),e("li",[_._v("执行复杂语句如果出错的话，会消耗更多资源；")])]),_._v(" "),e("h3",{attrs:{id:"row-优点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#row-优点"}},[_._v("#")]),_._v(" Row 优点")]),_._v(" "),e("ul",[e("li",[_._v("任何情况都可以被复制，这对复制来说是最安全可靠的；")]),_._v(" "),e("li",[_._v("和其他大多数数据库系统的复制技能一样；")]),_._v(" "),e("li",[_._v("多数情况下，从服务器上的表如果有主键的话，复制就会快了很多；")]),_._v(" "),e("li",[_._v("复制以下几种语句时的行锁更少：")]),_._v(" "),e("li",[_._v("INSERT … SELECT")]),_._v(" "),e("li",[_._v("包含 AUTO_INCREMENT 字段的 INSERT")]),_._v(" "),e("li",[_._v("没有附带条件或者并没有修改很多记录的 UPDATE 或 DELETE 语句")]),_._v(" "),e("li",[_._v("执行 INSERT，UPDATE，DELETE 语句时锁更少；")]),_._v(" "),e("li",[_._v("从服务器上采用多线程来执行复制成为可能；")])]),_._v(" "),e("h3",{attrs:{id:"row-缺点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#row-缺点"}},[_._v("#")]),_._v(" Row 缺点")]),_._v(" "),e("ul",[e("li",[_._v("生成的 binlog 日志体积大了很多；")]),_._v(" "),e("li",[_._v("复杂的回滚时 binlog 中会包含大量的数据；")]),_._v(" "),e("li",[_._v("主服务器上执行 UPDATE 语句时，所有发生变化的记录都会写到 binlog 中，而 statement 只会写一次，这会导致频繁发生 binlog - 的写并发请求；")]),_._v(" "),e("li",[_._v("UDF 产生的大 BLOB 值会导致复制变慢；")]),_._v(" "),e("li",[_._v("不能从 binlog 中看到都复制了写什么语句(加密过的)；")]),_._v(" "),e("li",[_._v("当在非事务表上执行一段堆积的 SQL 语句时，最好采用 statement 模式，否则很容易导致主从服务器的数据不一致情况发生；")]),_._v(" "),e("li",[_._v("另外，针对系统库 MySQL 里面的表发生变化时的处理准则如下：")]),_._v(" "),e("li",[_._v("如果是采用 INSERT，UPDATE，DELETE 直接操作表的情况，则日志格式根据 binlog_format 的设定而记录；")]),_._v(" "),e("li",[_._v("如果是采用 GRANT，REVOKE，SET PASSWORD 等管理语句来做的话，那么无论如何都要使用 statement 模式记录；")]),_._v(" "),e("li",[_._v("使用 statement 模式后，能处理很多原先出现的主键重复问题；")])]),_._v(" "),e("hr"),_._v(" "),e("p",[_._v("END")])])}),[],!1,null,null,null);v.default=a.exports}}]);