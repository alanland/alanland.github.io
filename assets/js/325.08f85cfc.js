(window.webpackJsonp=window.webpackJsonp||[]).push([[325],{1041:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("AWS 使用的第一个服务 RedShift。从安装命令行开始，到数据连接测试。中间拷贝数据遇到了点问题， 最后自己上传了一份样例数据到 S3 上进行了测试。")]),s._v(" "),t("h2",{attrs:{id:"cli-工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-工具"}},[s._v("#")]),s._v(" CLI 工具")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-install.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装 AWS CLI"),t("OutboundLink")],1)])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" awscli --upgrade --user\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/Users/alan/.local/bin:"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n\naws --version\n\npip list -o\n\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --upgrade --user awscli\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/getting-started_create-admin-group.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("IAM 用户和组"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("可以根据文档创建一个完整权限的编程用户。")]),s._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/redshift/latest/mgmt/setting-up-rs-cli.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("设置CLI"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[s._v("https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-configure.html")])])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("base"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ➜  ~ aws configure\nAWS Access Key ID "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("None"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": xx\nAWS Secret Access Key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("None"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": K/xxx\nDefault region name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("None"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": cn-northwest-1\nDefault output "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("None"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("格式只有 "),t("code",[s._v("json")]),s._v("，"),t("code",[s._v("text")]),s._v("， "),t("code",[s._v("table")]),s._v(" 三种， 要是有 yaml 格式i就好了。")]),s._v(" "),t("p",[s._v("如果要创建多个配置：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("aws configure --profile produser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("运行命令的时候可以指定 profile：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("aws s3 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" --profile produser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"access"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#access"}},[s._v("#")]),s._v(" Access")]),s._v(" "),t("p",[s._v("设置权限")]),s._v(" "),t("ul",[t("li",[s._v("https://docs.amazonaws.cn/en_us/redshift/latest/gsg/rs-gsg-authorize-cluster-access.html")])]),s._v(" "),t("p",[s._v("然后就可以通过客户端工具连接了。")]),s._v(" "),t("h2",{attrs:{id:"加载数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加载数据"}},[s._v("#")]),s._v(" 加载数据")]),s._v(" "),t("ul",[t("li",[s._v("https://docs.aws.amazon.com/zh_cn/redshift/latest/gsg/rs-gsg-create-sample-db.html")])]),s._v(" "),t("p",[s._v("执行")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" copy users "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s3://awssampledbuswest2/tickit/allusers_pipe.txt'")]),s._v("\n     credentials "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aws_iam_role=arn:aws-cn:iam::xxx:role/myRedshiftRole'")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'|'")]),s._v(" region "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cn-northwest-1'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("错误")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[2019-09-30 15:30:45] [XX000][500310] [Amazon](500310) Invalid operation: User arn:aws-cn:redshift:cn-northwest-1:xxx:dbuser:xxx/xxx is not authorized to assume IAM Role arn:aws-cn:iam::xxx:role/myRedshiftRole\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("解决")]),s._v(" "),t("p",[s._v("打开 cluster 设置，"),t("code",[s._v("IAM Roles")]),s._v(" 应用一下权限即可。")]),s._v(" "),t("p",[s._v("再次执行")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[XX000][500310] [Amazon](500310) Invalid operation: S3ServiceException:The specified bucket does not exist,Status 404,Error NoSuchBucket,Rid\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("再次执行")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("copy users "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s3://awssampledbuswest2/tickit/allusers_pipe.txt'")]),s._v("\ncredentials "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aws_iam_role=arn:aws-cn:iam::xxx:role/myRedshiftRole'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'|'")]),s._v(" region "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'us-west-2'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("S3ServiceException:The provided token is malformed or otherwise invalid\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/s3serviceexception-error.html")]),s._v(" "),t("p",[s._v("可能是集群和 s3 不在一个区域。")]),s._v(" "),t("ul",[t("li",[s._v("https://stackoverflow.com/questions/24860468/amazon-redshift-copy-command")])]),s._v(" "),t("p",[s._v("更改成宁夏区域：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("copy users "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s3://awssampledbcnnorthwest1/tickit/allusers_pipe.txt'")]),s._v("\n    credentials "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aws_iam_role=arn:aws-cn:iam::xxx:role/myRedshiftRole'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'|'")]),s._v(" region "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cn-northwest-1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("XX000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500310")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Amazon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500310")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Invalid operation: S3ServiceException:Access Denied,Status "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")]),s._v(",Error AccessDenied\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("柠檬了个鬼。")]),s._v(" "),t("p",[s._v("https://s3.cn-northwest-1.amazonaws.com.cn/cybertrans/Book1.csv")]),s._v(" "),t("p",[s._v("自己写了个数据放到 s3 上测试")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("copy users "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s3://cybertrans/users.csv'")]),s._v("\n    credentials "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aws_iam_role=arn:aws-cn:iam::xxx:role/myRedshiftRole'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" region "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cn-northwest-1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("OK。")]),s._v(" "),t("p",[s._v("文档中有复制权限到其他 region 的描述，没有测试。")]),s._v(" "),t("ul",[t("li",[s._v("https://docs.aws.amazon.com/zh_cn/redshift/latest/mgmt/authorizing-redshift-service.html")])]),s._v(" "),t("p",[s._v("先用测试数据进行了基本的查询，仅作测试用。由于数据量比较小也提现不出来性能什么的。今天先到这里。")]),s._v(" "),t("h2",{attrs:{id:"表设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#表设计"}},[s._v("#")]),s._v(" 表设计")]),s._v(" "),t("p",[s._v("https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/tutorial-tuning-tables-create-test-data.html")]),s._v(" "),t("hr")])}),[],!1,null,null,null);a.default=n.exports}}]);