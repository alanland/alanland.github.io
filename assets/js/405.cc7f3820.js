(window.webpackJsonp=window.webpackJsonp||[]).push([[405],{1134:function(s,a,t){"use strict";t.r(a);var n=t(6),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#要求"}},[s._v("#")]),s._v(" 要求")]),s._v(" "),t("ol",[t("li",[s._v("在库，出库，入库升级，打补丁不停机")]),s._v(" "),t("li",[s._v("升级，打补丁回滚不停机")])]),s._v(" "),t("h2",{attrs:{id:"实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[s._v("#")]),s._v(" 实现")]),s._v(" "),t("p",[s._v("支持不停机的打补丁、升级和回滚。（POC使用蓝绿发布）")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("如果灰度发布验证测试可根据用户和域名来切分流量，前者需特定用户登录系统验证，后者需任意用户访问灰度域名。")])]),t("h3",{attrs:{id:"打补丁和升级流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打补丁和升级流程"}},[s._v("#")]),s._v(" 打补丁和升级流程")]),s._v(" "),t("ul",[t("li",[s._v("确定当前版本号；eg："),t("code",[s._v("3.0.4")])]),s._v(" "),t("li",[s._v("确定补丁版本号；eg："),t("code",[s._v("3.0.5")])]),s._v(" "),t("li",[t("strong",[s._v("开发人员")]),s._v(" 发布并上传补丁版本镜像到容器镜像仓库\n"),t("ul",[t("li",[t("code",[s._v("docker push wms:3.0.5")])])])]),s._v(" "),t("li",[s._v("修改网关配置，开启 canary 的流量并重新加载配置"),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" wms "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("121.111")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9210")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("121.111")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9210")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("121.111")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9210")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" wms_c "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server 121.111.10.4:9210;")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server 121.111.10.5:9210;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("121.111")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9210")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("nginx -t\nnginx -s reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[s._v("使用新服务镜像版本"),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.0.5\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[s._v("访问 "),t("code",[s._v("wms-c.huawei.com")]),s._v(" 进行功能验证")]),s._v(" "),t("li",[s._v("验证成功则开启等量服务测试，并切换域名\n"),t("ul",[t("li",[s._v("验证失败不切换即可")])])])]),s._v(" "),t("h2",{attrs:{id:"回滚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回滚"}},[s._v("#")]),s._v(" 回滚")]),s._v(" "),t("p",[s._v("如果发现之前未验证的业务或者程序问题，需要回滚版本。流程同升级。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("关于服务治理")]),t("p",[s._v("线上环境如果有k8s，推荐使用 istio 来进行进行版本发布。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);