(window.webpackJsonp=window.webpackJsonp||[]).push([[337],{1058:function(s,t,a){"use strict";a.r(t);var e=a(6),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("Kong 提供了多种认证的插件，其中就包括 "),a("a",{attrs:{href:"https://docs.konghq.com/hub/kong-inc/hmac-auth/",target:"_blank",rel:"noopener noreferrer"}},[s._v("HMAC-Authentication"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[s._v("hmac-auth 几个要注意的配置项：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("config.clock_skew")]),s._v("： 默认3000秒，用来防止重放攻击。请求的时间戳和服务器时间相隔超过这个时间，客户端会提示 invalid date。\n"),a("ul",[a("li",[s._v("docker 环境运行 kong 的时候要特别主意时区")])])]),s._v(" "),a("li",[a("code",[s._v("config.validate_request_body")]),s._v("： 默认 false")]),s._v(" "),a("li",[a("code",[s._v("config.enforce_headers")]),s._v("：HTTP 签名的必须的头信息列表")]),s._v(" "),a("li",[a("code",[s._v("config.algorithms")]),s._v("： 算法。比如 hmac-sha256")])]),s._v(" "),a("p",[s._v("请求的格式：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -i -X GET http://localhost:8000/requests "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Host: hmac.com"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Date: Thu, 22 Jun 2017 17:15:21 GMT"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'Authorization: hmac username="alice123", algorithm="hmac-sha256", headers="date request-line", signature="ujWCGHeec9Xd6UD2zlyxiNMCiXnDOWeVFMu5VeRUxtw="\'')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("其中 date 必须是GMT格式的。")]),s._v(" "),a("p",[s._v("signature 的算法：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("signing_string")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"date: Thu, 22 Jun 2017 17:15:21 GMT'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('GET /requests HTTP/1.1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("digest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("HMAC-SHA256"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("signing_string"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secret"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("base64_digest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("base64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("digest"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如果 headers 为 "),a("code",[s._v("date host request-line")]),s._v("，那么 signing string 为：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("date: Thu, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" Jun "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":15:21 GMT\nhost: hmac.com\nGET /requests HTTP/1.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[s._v("header key 为小写，然后冒号空格，值后面加回车。最后一行后面不能跟回车。")])]),a("p",[s._v("如果有 request-line，那么 signing string 后拼接 http request line。")]),s._v(" "),a("p",[s._v("如果 hmac-auth 配置里面 header 不要求 request-line，那么 signing string 就是：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("date: Thu, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" Jun "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":15:21 GMT\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("HMAC-SHA 可以通过这个"),a("a",{attrs:{href:"https://www.devglan.com/online-tools/hmac-sha256-online",target:"_blank",rel:"noopener noreferrer"}},[s._v("在线工具"),a("OutboundLink")],1),s._v(" 来计算。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[s._v("关于签名")]),a("p",[s._v("一般我们要求 "),a("code",[s._v("host")]),s._v("，"),a("code",[s._v("date")]),s._v("，"),a("code",[s._v("request-line")]),s._v(" 来进行签名。要求高的话，就开启 request-body 校验。")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[s._v("HMAC Auth的优点")]),a("ul",[a("li",[s._v("不传播密码")]),s._v(" "),a("li",[s._v("参数加密，防止敏感信息")]),s._v(" "),a("li",[s._v("HMAC 摘要防篡改")]),s._v(" "),a("li",[s._v("加入时间戳，防止重放攻击")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);